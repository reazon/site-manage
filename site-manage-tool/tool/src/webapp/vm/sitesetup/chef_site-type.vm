##<!-- $Header: /cvs/sakai2/legacy/tools/src/webapp/vm/sitesetup/chef_site-type.vm,v 1.3 2005/06/04 02:41:16 ggolden.umich.edu Exp $ -->

#*
	routing logic
	
	1 - if user selects a template with site type not course --> go to site
	2 - if user selects a template with site type course --> go to roster selection, offer the choice there 
		of going to site when done
	3 - if build own selected --> as usual	

	in cases 1 and 2 site should be unpublished so that user can adjust before others have access

*#

<script type="text/javascript" src="/library/js/jquery/jquery-ui/js/jquery.js"></script>
<script type="text/javascript" src="/library/js/jquery/jquery-ui/js/jquery-ui.js"></script>
<link type="text/css" href="/library/js/jquery/jquery-ui/css/smoothness/jquery-ui.css" rel="stylesheet" media="screen" />
<script type="text/javascript" src="/sakai-site-manage-tool/js/site-manage.js"></script>
<link type="text/css" href="/sakai-site-manage-tool/css/site-manage.css" rel="stylesheet" media="screen" />
<script type="text/javascript" language="JavaScript">
    $(document).ready(function(){
		$('input[name="itemType"]').attr('checked','');
		$('#copy').click(function(e){
			$('#templateSettings').fadeIn('fast');
			$('#buildOwn').attr('checked','')	;
			$('#siteTypeList').fadeOut('fast');	
			$('#termList').fadeOut('fast');
			utils.resizeFrame('grow');
			$('#submitFromTemplate').fadeIn('fast');
			$('#submitBuildOwn').fadeOut('fast');				
				$('#submitBuildOwn').attr('disabled', 'disabled');
		});
		
		$('#buildOwn').click(function(e){
			$('#templateSettings').fadeOut('fast');				
			$('#templateSettings input:checked').attr('checked','');				
			$('#siteTitleField').attr('value','');	
			$('input[id="copy"]').attr('checked','');
			$('#templateSettings select').attr('selectedIndex',0);
			$('#templateSettings span').fadeOut('fast');
			$('#siteTypeList').fadeIn('fast');				
			$('#submitFromTemplate').fadeOut('fast');
			$('#submitFromTemplateCourse').fadeOut('fast');
			$('#submitBuildOwn').fadeIn('fast');				
			$('#nextInstructions span').fadeOut('fast');			
			utils.resizeFrame('grow');
		});
		$('#siteTitleField').keyup(function (e) {
			console.log ( $(this).attr('value').length)
			if ($(this).attr('value').length >= 1){
				$('#submitFromTemplate').attr('disabled', '');
			}
			else{
				$('#submitFromTemplate').attr('disabled', 'disabled');
			}
			});

	
		$('#selectTermTemplate').change(function(){
			if (this.selectedIndex === 0) {
				$('#submitFromTemplateCourse').attr('disabled', 'disabled');
			}
			else {
				$('#submitFromTemplateCourse').attr('disabled', '');
			
			}
			});
		
		$('#templateSiteId').change(function(){
			if (this.selectedIndex === 0) {
				$('#templateSettings span').fadeOut('fast');
				$('#templateSettings select').attr('selectedIndex',0);
				$('#submitFromTemplateCourse').attr('disabled', 'disabled');
			}
			else {
				var type = $('#templateSiteId option:selected').attr('class');
				$('#templateSettings span').fadeOut('fast');
				$('#nextInstructions span').fadeOut('fast');
				if (type == "course") {
					$('#templateCourseInstruction').fadeIn('fast');
					$('#submitFromTemplate').fadeOut('fast');
					$('#submitFromTemplateCourse').fadeIn('fast');
					$('#siteTerms').fadeIn('fast');
					$('#siteTerms select').focus();
					$('#siteTitleField').attr('value','');
				}
				else {
					$('#submitFromTemplate').fadeIn('fast');
					$('#submitFromTemplateCourse').fadeOut('fast');
					$('#templateNonCourseInstruction').fadeIn('fast');
					$('#siteTitle').fadeIn('fast');
					$('#siteTerms select').attr('selectedIndex',0);
					$('#siteTitle input').focus();
				}
			}
		});
		$('#siteTypeList input').click(function(e){
			if ($(this).attr('id') =='course'){
				$('#termList').fadeIn('fast');
			}
			else{
				$('#termList').fadeOut('fast');
			}
			$('#submitBuildOwn').attr('disabled', '');

	});
	});
/*

 	function selectSiteType(type)
 	{
 		for (var i=0; i<document.typeform.itemType.length; i++)
 		{
 			if (document.typeform.itemType[i].value==type)
 			{
 				document.typeform.itemType[i].checked=true;
 			}
 			else
 			{
 				document.typeform.itemType[i].checked=false;
 			}
 		}
 	}
 	
 	function toggleTemplateSelectList (type)
 	{
 		var selectTemplateType = "selectTemplate" + type;
 		var templateList = document.getElementById(selectTemplateType);
 		templateList.disabled = !templateList.disabled;
 		
 		var useTemplateType = "useTemplate" + type;
 		var useTemplateTypeCheckbox = document.getElementById(useTemplateType);
 		if (useTemplateTypeCheckbox.checked)
 		{
 			selectSiteType(type);
 		}
 	}
 	
 	function selectTemplateSite (type)
 	{
 		for (var i=0; i<document.typeform.itemType.length; i++)
 		{
 			var templateType = "template" + type;
 			if (document.typeform.itemType[i].value==templateType)
 			{
 				document.typeform.itemType[i].checked=true;
 			}
 			else
 			{
 				document.typeform.itemType[i].checked=false;
 			}
 		}
 	}

*/
</script>
<div class ="portletBody">

	<h3>
		$tlang.getString("sitetype.crenewsit") 
	</h3>
	#if ($alertMessage)<div class="alertMessage">$tlang.getString("sitetype.alert") $validator.escapeHtml($alertMessage)</div>	#end
	<p class="step">
		## NOTE: below does not seem to be working
		#if ($templateList.size() > 0)
			## if there is template site types
			$tlang.getString("sitetype.chothetyp.withtemplate")
		#else
			## if there is NO template site types
			$tlang.getString("sitetype.chothetyp.withouttemplate")
		#end
	</p>
	<form name="typeform" id="typeform" action="#toolForm("$action")" method="post">
		## NOTE: if create from template is enabled
		<p class="checkbox indnt1">
			<input type="radio" name="createMode" id="buildOwn" value="buildOwn" checked="checked"/>	
			<label for="buildOwn">$tlang.getString("sitetype.buildown")</label>
		</p>
		## NOTE: end if create from template enabled
		#* following block should show if "build own" has been selected,
		 a site type has been picked, and then the user (from the next screen) hits "back"	- the "Build own" radio
		 should be checked, as well as the selected site type
		 *#
		<div id="siteTypeList"  class="indnt3"
		 #* if templates enabled *# class="indnt3" #*end templates enabled *#>
		#foreach ($type in $siteTypes)
			#if (($type != "GradToolsStudent" && $type != $courseSiteType) || ($type == $courseSiteType && $canAddCourse) || ($type == "GradToolsStudent" && $!withDissertation && $!isGradStudent.booleanValue() && $!noGradToolsSite.booleanValue()))
				<p class="checkbox indnt1">
					<input type="radio" name="itemType" id="$type" value="$type" #if ($type == $typeSelected) checked="checked" #end/>
						<label for = "$type">
							#if ($type == "GradToolsStudent")
								$tlang.getString("sitetype.gratooweb")
							#else
								$type $tlang.getString("sitetype.websit")	
							#end
						</label>	
				</p>		
						#if ($type == $courseSiteType && $canAddCourse)
							<div class="indnt3" id="termList" style="display:none;">
								<p class="shorttext required">
									<span class ="reqStar" id="term-required"> *</span>
									<label for="selectTerm">
										$tlang.getString("sitetype.acater")
									</label>	
									<select name="selectTerm" id="selectTerm">  ## onclick="selectSiteType('$type')"
										#foreach($term in $termList)
											<option value ="$term.eid"
												#if ($!selectedTerm)
													#if ($term.eid == $selectedTerm.eid)
														selected="selected"
													#end
												#else
													#if ($term.isCurrentTerm())
														selected="selected"
													#end
												#end
											>
											$term.title
											</option>
										#end
									</select> 
								</p>	
							</div>	
						#end
			#end
			#if ($templateList.size() > 0 && $templateList.containsKey($type))
					<p class="checkbox indnt3">
							#set($templatetype="useTemplate")
							#set($templatetype=$templatetype.concat($type))
							<input type="checkbox" name="$templatetype" id="$templatetype" value="$templatetype" onchange="toggleTemplateSelectList('$type');"/>
							<label for = "$templatetype">$tlang.getString("sitetype.usetemplate")</label>
							&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
							<select name="selectTemplate$type" id="selectTemplate$type" disabled="true">
								#foreach($template in $templateList.get($type))
									<option value ="$template.getId()">
										$template.getTitle()
									</option>
								#end
							</select> 
						</p>
					#end
		#end
			</div>
	 ## if templates enabled
		<p class="checkbox indnt1">
			<input type="radio" name="itemType" id="copy" value="copy"/>
			<label for="copy">$tlang.getString("sitetype.createfromtemplate")</label>
		</p>
		<div class="indnt3"  id="templateSettings" style="display:none">	
		<div>
			<strong class="reqStarInline"> * </strong>
				<select id="templateSiteId" name="templateSiteId">
					<option value ="0">$tlang.getString("sitetype.selectTemplate")</option>
					#*
					#foreach($templateSite in $templateSites)
						<option value ="$templateSite.id" class="$templateSite.type">$templateSite.title</option>
					#end
						these are just examples below - the main thing is that the type of site that the template is should 
						be added to the <option /> in the class attribute 
					*#
					<option value ="$templateSite.id" class="course">Course - Humanities</option>
						<option value ="$templateSite.id" class="course">Course - Engineering</option>
					<option value ="$templateSite.id" class="project">Project - Journal</option>						
					<option value ="$templateSite.id" class="project">Project - Currilum Review</option>						
				</select>
				#*
				title length restrictions are copied from template chef_site-siteInfo-editInfo.vm maxlength needs to be set like in that template
				*#
				<span id="siteTitle"  style="display:none"><strong class="reqStarInline"> * </strong><label style="float:none" for="siteTitleField">$tlang.getString("sitetype.sitetitle") </label><input type="text" value="" size="20" maxlength="$!titleMaxLength"  id="siteTitleField" name="siteTitle"/></span>
				<span id="siteTerms" style="display:none"><strong class="reqStarInline"> * </strong>
					<select name="selectTermTemplate" id="selectTermTemplate">
						<option value ="0">$tlang.getString("sitetype.selectTerm")</option>
						#foreach($term in $termList)
							<option value ="$term.eid"
								#if ($!selectedTerm)
									#if ($term.eid == $selectedTerm.eid)
										selected="selected"
									#end
								#else
									#if ($term.isCurrentTerm())
										selected="selected"
									#end
								#end
							>
							$term.title
							</option>
						#end
					</select> 				
				</span>
			</div>	
			<div style="padding:5px 8px;">
			<input type="checkbox" name="copyUsers" id="copyUsers" value="copyUsers"/>	
			<label for="copyUsers">$tlang.getString("sitetype.copyusers")</label>
			<input type="checkbox" name="copyContent" id="copyContent" value="copyContent"/>	
			<label for="copyContent">$tlang.getString("sitetype.copycontent")</label>
			</div>
		</div>
		## end templates enabled

		<input type="hidden" name="back" value="$!backIndex" />
		<input type="hidden" name="templateIndex" value="$!templateIndex" />
		</div>
		<div class="instruction" id ="nextInstructions">
				<span id="templateCourseInstruction" style="display:none">$tlang.getString("sitetype.templatecourseinstruction")</span>
				<span id="templateNonCourseInstruction" style="display:none">$tlang.getString("sitetype.templatenoncourseinstruction")</span>
		</div>	
		<div class ="act" style="padding:0">
			#* this submit should create the site from the template and redirect user to site
			 it should be set style="display:none" if user is coming back
			 ot this template from building own flow
			 *#
			<input type="submit" accesskey="s"  id="submitFromTemplate" disabled="disabled" style="display:none" class="active" name="needANewNameForThis" value="$tlang.getString("sitetype.done")" />
			<input type="submit" accesskey="s"  id="submitFromTemplateCourse" disabled="disabled" style="display:none" class="active" name="needANewNameForThis" value="$tlang.getString("sitetype.donecourse")" />
			## this submit should be ther normal one
			<input type="submit" accesskey="s"  id="submitBuildOwn" disabled="disabled" class="active" name="eventSubmit_doSite_type" value="$tlang.getString("sitetype.con")" />
			<input type="submit" accesskey="x" name="eventSubmit_doCancel_create" value="$tlang.getString("sitetype.can")" />
		</div>

	</form>				
</div>	

